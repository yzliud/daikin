<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>报价单生成</title>
<meta name="viewport"
	content="width=device-width,initial-scale=1,user-scalable=0">
<link rel="stylesheet" href="css/new_weui/weui.css" />
<link rel="stylesheet" href="css/new_weui/weui2.css" />
<link rel="stylesheet" href="css/new_weui/weui3.css" />
<script src="js/zepto.min.js">
	
</script>
</head>
<script>
	function upDownOperation(element) {
		var _input = element.parent().find('input'), _value = _input.val(), _step = _input
				.attr('data-step') || 1;
		//检测当前操作的元素是否有disabled，有则去除
		element.hasClass('disabled') && element.removeClass('disabled');
		//检测当前操作的元素是否是操作的添加按钮（.input-num-up）‘是’ 则为加操作，‘否’ 则为减操作
		if (element.hasClass('weui-number-plus')) {
			var _new_value = parseInt(parseFloat(_value) + parseFloat(_step)), _max = _input
					.attr('data-max') || false, _down = element.parent().find(
					'.weui-number-sub');

			//若执行‘加’操作且‘减’按钮存在class='disabled'的话，则移除‘减’操作按钮的class 'disabled'
			_down.hasClass('disabled') && _down.removeClass('disabled');
			if (_max && _new_value >= _max) {
				_new_value = _max;
				element.addClass('disabled');
			}
		} else {
			var _new_value = parseInt(parseFloat(_value) - parseFloat(_step)), _min = _input
					.attr('data-min') || false, _up = element.parent().find(
					'.weui-number-plus');
			//若执行‘减’操作且‘加’按钮存在class='disabled'的话，则移除‘加’操作按钮的class 'disabled'
			_up.hasClass('disabled') && _up.removeClass('disabled');
			if (_min && _new_value <= _min) {
				_new_value = _min;
				element.addClass('disabled');
			}
		}
		_input.val(_new_value);
	}

	$(function() {
		$('.weui-number-plus').click(function() {
			upDownOperation($(this));
		});
		$('.weui-number-sub').click(function() {
			upDownOperation($(this));
		});

	});
</script>
</head>

<body style="background-color: #f8f8f8;">
	<div class="weui_cells weui_cells_form " id="space">

	</div>

	<div class="weui_btn_area">
		<a id="formSubmitBtn" href="javascript:create();"
			class="weui_btn weui_btn_primary">提交</a>
	</div>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" charset="utf-8">
		window.onload = function() {
			$.ajax({
				type: "post",
				url: "../../a/api/quotation/getAllProduct",
				data: {},
				dataType: "JSON",
				success: function(data) {
 						for(var i = 0; i < data.length; i++) {
 						var div = document.createElement('div');
 						div.className = 'weui_cell';
						div.innerHTML=
							"<div class='weui_cell_bd weui_cell_primary'>"+
								"<p>"+data[i].name+"</p>"+
							"</div>"+
							"<div class='weui_cell_bd weui_cell_primary'>"+
								"<p>￥"+data[i].price+"</p>"+
							"</div>"+
							"<div style='font-size: 0px;' class='weui_cell_ft'>"+
								"<a class='weui-number weui-number-sub needsclick' onclick='upDownOperation($(this));'> - </a> <input "+
									"id='"+data[i].id+"' pattern='[0-9]*' class='weui-number-input' "+
									"style='width: 50px;' value='0' data-min='0' data-max='999' "+
									"data-step='1'> <a "+
									"class='weui-number weui-number-plus needsclick' onclick='upDownOperation($(this));'> + </a> "+
							"</div>"+
							"<div class='weui_cell_ft' style='display: none;'>0</div> ";
						$("#space").append(div);
					}
				},
				error: function() {}
			});
		}

		function create() {
			alert("报价单");
			var inputid = "";
			var inputArray = $("input");//取到所有的input并且放到一个数组中  
			inputArray.each(//使用数组的循环函数 循环这个input数组  
			function() {
				var input = $(this);//循环中的每一个input元素  
				if ($('#' + input.attr("id")).val() > 0) {
					inputid += input.attr("id") + ":"
							+ $('#' + input.attr("id")).val() + ",";//查看循环中的每一个input的id  	
				}
			});
			if (inputid == '') {
				alert('请选择商品！');
			} else {
				$.ajax({
					url : "../../a/api/quotation/create",
		            data: {
		            	"product":inputid,
		            	"name":getQueryString("name"),
						"member_name":getQueryString("member_name"),
						"mobile":getQueryString("mobile"),
						"address":getQueryString("address"),
						"product_type":getQueryString("product_type"),
		            	},
					type : "post",
					dataType : 'json',
					async : false,
					success : function(data) {//ajax返回的数据
						if (data.msg == 'success') {
							alert('保存成功');
							window.location.href = "quotation_1.html";
						} else {
							alert('保存失败');
						}
					}
				});
			}

		}

		function getQueryString(name) { //输入参数名称
			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); //根据参数格式，正则表达式解析参数
			var r = window.location.search.substr(1).match(reg);
			if (r != null)
				return unescape(r[2]);
			return null; //返回参数值
		}
	</script>
</body>

</html>